<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.milite.mapper.CharacterStatusMapper">
	<!-- 캐릭터 DB에서 해당 이름과 일치하는 캐릭터의 정보 가져오기 -->
	<select id="getCharInfo"
		resultType="com.milite.dto.CharacterDto">
		select * from CharacterDB where name = #{name}
	</select>

	<!-- 플레이어DB에서 현재 플레이 중인 캐릭터 상황 불러오기 -->
	<select id="getPlayerInfo" resultType="com.milite.dto.PlayerDto">
		select
		Player_ID as
		playerID,
		Using_Character,
		curr_hp,
		max_hp,
		atk,
		luck,
		WhereSession,
		WhereStage,
		EventAtk,
		EventCurrHp,
		EventMaxHp,
		Using_Skill,
		Own_Skill,
		Own_Artifact
		from PlayerDB
		where Player_ID = #{PlayerID}
	</select>

	<!-- PlayerDB에 전투관련 스탯의 변경점을 업데이트하기 -->
	<update id="updateStatus"
		parameterType="com.milite.dto.PlayerDto">
		update PlayerDB
		<trim prefix="set" suffixOverrides=",">
			<if test="curr_hp != null">curr_hp = #{curr_hp},</if>
			<if test="max_hp != null">max_hp = #{max_hp},</if>
			<if test="atk != null">atk = #{atk},</if>
			<if test="luck != null">luck = #{luck},</if>
			<if test="Own_Skill != null"> Own_Skill = #{Own_Skill},</if>
			<if test="Own_Artifact != null"> Own_Artifact = #{Own_Artifact},</if>
		</trim>
		<where>
			<if test="Player_ID != null">Player_ID = #{PlayerID}</if>
		</where>
	</update>

	<update id="replacePhoenixFeathers" parameterType="String">
		update
		PlayerDB
		set Own_Artifact =
		replace(Own_Artifact, '119', '120')
		where
		Player_ID =
		#{playerID}
		and
		find_in_set('119', Own_Artifact) > 0
	</update>
</mapper>
	